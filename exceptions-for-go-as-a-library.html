<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=endge, chrome=IE8" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width, user-scalable=no" />
    <title> Exceptions for Go as a Library </title>
    <link href='https://fonts.googleapis.com/css?family=Alice' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
    <!--[if lte IE 8]><script type="text/javascript" src="https://hackthology.com/theme/js/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" type="text/css" href="theme/css/skeleton.css" />
    <link rel="stylesheet" type="text/css" href="theme/css/theme.css" />
    <link rel="shortcut icon" type="image/png" href="https://hackthology.com/favicon.png" />
    <!--[if lte IE 8]><link rel="shortcut icon" type="image/x-icon" href="https://hackthology.com/favicon.ico" /><![endif]-->
    <link rel="alternate" type="application/atom+xml"
                           title="Hackthology — Flux Atom"
                           href="https://hackthology.com/" /> 
    <link rel ="alternate" type="application/rss+xml"
                           title="Hackthology — Flux RSS"
                           href="https://hackthology.com/feeds/rss.xml" /> 
    <link rel="canonical" href="https://hackthology.com/exceptions-for-go-as-a-library.html"/>
    <meta name="keywords" content="" />
    <link rel="stylesheet" media="not print" type="text/css" href="https://hackthology.com/theme/css/pygments.css" /> 
  </head>
  <body>
    <div id="page">
      <header id="page-head">
        <h1>
          <a href="https://hackthology.com/index.html">Hackthology</a>
        </h1>
        <h3>
          The Discourses of Tim Henderson
        </h3>
        <div class="top-nav">
<ul>
    <li><a href="https://hackthology.com/articles.html">articles</a></li>
    <li><a href="https://hackthology.com/pages/about.html">about</a></li>
    <li><a href="https://hackthology.com/pages/publications.html">publications</a></li>
    <li><a href="https://hackthology.com/pages/teaching.html">teaching</a></li>
</ul>
<ul>
    <li><a href="https://hackthology.com/feeds/rss.xml">rss-feed</a></li>
    <li><a href="https://github.com/timtadh">github</a></li>
    <li><a href="https://twitter.com/timtadh">twitter</a></li>
    <li><a href="https://www.linkedin.com/in/tadh">linkedin</a></li>
    <li><a href="https://keybase.io/tadh">keybase</a></li>
</ul></div>
      </header>
      
      <div id="page-body">

        <article class="post" id="page-main" role="main">
      <header class="post-header">
        <h1 class="full">
          <a rel="bookmark"
             href="https://hackthology.com/exceptions-for-go-as-a-library.html"
             title="perm link Exceptions for Go as a Library">
             Exceptions for Go as a Library
          </a>
        </h1>
        <div class="meta">
<!-- includes/article_meta.html -->
          <div class="meta">
            by &nbsp;Tim Henderson
<br/> <time datetime="2016-05-19T00:00:00-04:00">Thu 19 May 2016</time></div>        </div>
      </header>
      <div class="post-content"> 
        <p>Go (golang) lacks support for exceptions found in many other languages. There
are good reasons for Go to not include exceptions. For instance, by making
error handling explicit the programmer is forced to think concretely about
the correct action to take. Fined grained control over the handling of errors
using multiple return parameters is one of Go's strengths.</p>
<p>However, there are cases where Go programs do not universally benefit from
the explicit handling of errors. For instance, consider the following code:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">DoStuff</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">foo</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bar</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bax</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">baz</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p>If Go had exceptions such code could be easily simplified:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">DoStuff</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="nx">throws</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">foo</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<span class="w">    </span><span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bar</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<span class="w">    </span><span class="nx">baz</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">bax</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3>Adding Exceptions with a Library</h3>
<p>I created a <a href="https://github.com/timtadh/data-structures/exc">library</a> which adds
support for exceptions to the go programming language.  This library allow you
to write go with exceptions and try-catch-finally blocks. It is not appropriate
for all situations but can simplify some application code. Libraries and
external APIs should continue to conform to the Go standard of returning error
values.</p>
<p>Here is an example of the <code>DoStuff</code> function where foo, bar and baz all throw
exceptions instead of returning errors. (We will look at the case where they
return errors that you want to turn into exceptions next). We want DoStuff to
be an public API function and return an error:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">DoStuff</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">exc</span><span class="p">.</span><span class="nx">Try</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">foo</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<span class="w">        </span><span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bar</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<span class="w">        </span><span class="nx">baz</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">bax</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">Error</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h4>Catch Blocks</h4>
<p>Now let's consider the case where we want to catch the exception log and
reraise it:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">DoStuff</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">exc</span><span class="p">.</span><span class="nx">Try</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">foo</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<span class="w">        </span><span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bar</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<span class="w">        </span><span class="nx">baz</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">bax</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">Catch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">exc</span><span class="p">.</span><span class="nx">Exception</span><span class="p">{},</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="nx">exc</span><span class="p">.</span><span class="nx">Throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">        </span><span class="nx">exc</span><span class="p">.</span><span class="nx">Rethrow</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">exc</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;rethrow after logging&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">Error</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p>Rethrow will chain the Throwable <code>t</code> with the new <code>*Error</code> created such that
if/when the exception reaches the top level you know exactly how it was
created and where it was re-thrown.</p>
<h4>Throwing Errors</h4>
<p>Ok, what about interacting with regular Go APIs which return errors? How can
we turn those errors into exceptions? The easy was is to use the
<code>ThrowOnError</code> function which is a sugar for:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ThrowErr</span><span class="p">(</span><span class="nx">ErrorFrom</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p>So converting out original <code>DoStuff</code> function we get</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">DoStuff</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Throws</span>
<span class="w">    </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">foo</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<span class="w">    </span><span class="nx">exc</span><span class="p">.</span><span class="nx">ThrowOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bar</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<span class="w">    </span><span class="nx">exc</span><span class="p">.</span><span class="nx">ThrowOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bax</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
<span class="w">    </span><span class="nx">exc</span><span class="p">.</span><span class="nx">ThrowOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="nx">exc</span><span class="p">.</span><span class="nx">ThrowOnError</span><span class="p">(</span><span class="nx">baz</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>

<p>This package also supports: catching user defined exceptions, catching
multiple exception types, <code>Close</code> which works like the "try with resources"
construct in Java 7+, (multiple) finally blocks, and a choice between
propagating exceptions with <code>Unwind</code> or retrieving the error/exception with
<code>Error</code> and <code>Exception</code> functions.</p>
<p>One Gotcha! The <code>Try()</code> function creates a <code>*Block</code> struct. To execute the
block you must either call: <code>Unwind</code>, <code>Error</code>, or <code>Exception</code>. <code>Unwind</code>
executes the block, if there is an exception coming out of the block it
continues to cause the program stack unwind. <code>Error</code> and <code>Exception</code> execute
the block, but return the exception as a value to deal with in the usual Go
way.</p>
<h4>Finally Blocks</h4>
<p>Finally blocks are a great feature of exceptions. They allow you to have a block
of code run unconditionally after a try and catch block even if there was an
un-handled exception or re-raised exception. In this example I use a finally
block to log the timing information of the DoStuff function.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">DoStuff</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">start</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">exc</span><span class="p">.</span><span class="nx">Try</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">foo</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<span class="w">        </span><span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bar</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<span class="w">        </span><span class="nx">baz</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">bax</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">Catch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">exc</span><span class="p">.</span><span class="nx">Exception</span><span class="p">{},</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="nx">exc</span><span class="p">.</span><span class="nx">Throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">        </span><span class="nx">exc</span><span class="p">.</span><span class="nx">Rethrow</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">exc</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;rethrow after logging&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">Finally</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">end</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Do stuff took: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">end</span><span class="p">.</span><span class="nx">Sub</span><span class="p">(</span><span class="nx">start</span><span class="p">))</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">Error</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h4>Automatically Closing Resources</h4>
<p>One common situation is to open a resource (like a file) and want it to close no
matter what. In Go this is often accomplished with a <code>defer</code> function. However,
we can accomplish the same thing with finer granularity using the <code>Close</code>
function which acts like a <code>Try</code> but automatically closes a created resource
when the block exits:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Close</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Closer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="s">&quot;/tmp/wizard&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">ThrowOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">f</span>
<span class="p">},</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Closer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">f</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">c</span><span class="p">.(</span><span class="o">*</span><span class="nx">os</span><span class="p">.</span><span class="nx">File</span><span class="p">)</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">&quot;wizardry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">ThrowOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">Unwind</span><span class="p">()</span>
</code></pre></div>

<p>In the above code, the file created in the first function will always be closed
at the end of the *Block even if WriteString had an error. This get more
interesting if you imagine passing the resource to other functions which could
throw exceptions.</p>
<h4>User Defined Exception Types</h4>
<p>To create a user defined exception simply create a struct which inherits from
the <code>exc.Exception</code> struct by embedding it as the first member.</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">MyException</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">exc</span><span class="p">.</span><span class="nx">Exception</span>
<span class="p">}</span>
</code></pre></div>

<p>Then you can catch <em>MyException with </em>Exception. eg:</p>
<div class="highlight"><pre><span></span><code><span class="nx">exc</span><span class="p">.</span><span class="nx">Try</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Throw</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">MyException</span><span class="p">{</span><span class="o">*</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;My Exception&quot;</span><span class="p">).</span><span class="nx">Exception</span><span class="p">()})</span>
<span class="p">}).</span><span class="nx">Catch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Exception</span><span class="p">{},</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="nx">Throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="s">&quot;caught!&quot;</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">Unwind</span><span class="p">()</span>
</code></pre></div>

<p>This should work with heirarchies of exceptions allowing your code to declare
specific exceptions for specific errors.</p>
<h3>How does it work?</h3>
<p>Go provides <code>panic</code> and <code>recover</code> as <a href="https://golang.org/ref/spec#Handling_panics">built-in
functions</a>. <code>panic(.)</code> allows you
to cause the program to halt and the stack to "unwind". This means stack frame
by stack frame the each function is halted and any deferred functions are run.
Let's look at an example:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">a</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;defer a&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">b</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">b</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;defer b&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">c</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">c</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;defer c&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;c panic&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">a</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">a</span>
<span class="n">b</span>
<span class="n">c</span>
<span class="n">defer</span><span class="w"> </span><span class="n">c</span>
<span class="n">defer</span><span class="w"> </span><span class="n">b</span>
<span class="n">defer</span><span class="w"> </span><span class="n">a</span>
<span class="nl">panic</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">panic</span>

<span class="n">goroutine</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">[</span><span class="n">running</span><span class="o">]</span><span class="err">:</span>
<span class="n">panic</span><span class="p">(</span><span class="mh">0x128360</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1040a140</span><span class="p">)</span>
<span class="w">    </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="k">go</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">481</span><span class="w"> </span><span class="o">+</span><span class="mh">0x700</span>
<span class="n">main</span><span class="p">.</span><span class="n">c</span><span class="p">()</span>
<span class="w">    </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">sandbox797297488</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">28</span><span class="w"> </span><span class="o">+</span><span class="mh">0x180</span>
<span class="n">main</span><span class="p">.</span><span class="n">b</span><span class="p">()</span>
<span class="w">    </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">sandbox797297488</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">20</span><span class="w"> </span><span class="o">+</span><span class="mh">0x140</span>
<span class="n">main</span><span class="p">.</span><span class="n">a</span><span class="p">()</span>
<span class="w">    </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">sandbox797297488</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">12</span><span class="w"> </span><span class="o">+</span><span class="mh">0x140</span>
<span class="n">main</span><span class="p">.</span><span class="n">main</span><span class="p">()</span>
<span class="w">    </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">sandbox797297488</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">32</span><span class="w"> </span><span class="o">+</span><span class="mh">0x20</span>
</code></pre></div>

<p>(try it on the playground <a href="https://play.golang.org/p/0Vp4jq0978">https://play.golang.org/p/0Vp4jq0978</a>)</p>
<p>So panic by default kills your program but gives you a nice stack trace. It also
runs your <code>defer</code>ed functions which allows some cleanup to happen. Recognizing
this was rather limited and their are times even in Go when it is nice to
recover from what is usually a fatal error (like in webservers) Go also provides
<code>recover</code>.</p>
<p>The <code>recover</code> function can be thought of as a limited panic catching function.
It can only meaingfully be used inside of defer functions. When a <code>recover</code> is
found it will stop the panic (that is stop unwinding the stack) and allow the
function the <code>defer</code>ed <code>recover</code> is in to exit normally. Let's look at another
example:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">a</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;defer a&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">b</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;end a&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">b</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;defer b&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nb">recover</span><span class="p">()</span>
<span class="w">    </span><span class="p">}()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">c</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;end b&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">c</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;defer c&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;c panic&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;end c&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;start&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">a</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">start</span>
<span class="nv">a</span>
<span class="nv">b</span>
<span class="nv">c</span>
<span class="nv">defer</span><span class="w"> </span><span class="nv">c</span>
<span class="nv">defer</span><span class="w"> </span><span class="nv">b</span>
<span class="k">end</span><span class="w"> </span><span class="nv">a</span>
<span class="nv">defer</span><span class="w"> </span><span class="nv">a</span>
<span class="k">end</span>
</code></pre></div>

<p>(Try it on the playground: <a href="https://play.golang.org/p/WTzKywhey2">https://play.golang.org/p/WTzKywhey2</a>)</p>
<p>This time, instead of the program crashing it exited normally. Functions, <code>a</code>
and <code>main</code>, who invocations occurred before <code>b</code> which invoked <code>recover</code> exited
normally. However, using recover like this will stop all errors and not explain
what the problem is. Luckily, recover reports whether or not a panic was
recovered and what the argument to the panic was. Here is an example:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">a</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;defer a&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">recover</span><span class="p">();</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;recovered&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;end defer of a&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">b</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;end a&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">b</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;defer b&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">recover</span><span class="p">();</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;recovered&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;end defer of b&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">c</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;end b&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">c</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;defer c&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;c panic&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;end c&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;start&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">a</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">start</span>
<span class="nv">a</span>
<span class="nv">b</span>
<span class="nv">c</span>
<span class="nv">defer</span><span class="w"> </span><span class="nv">c</span>
<span class="nv">defer</span><span class="w"> </span><span class="nv">b</span>
<span class="nv">recovered</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="nv">panic</span>
<span class="k">end</span><span class="w"> </span><span class="nv">defer</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">b</span>
<span class="k">end</span><span class="w"> </span><span class="nv">a</span>
<span class="nv">defer</span><span class="w"> </span><span class="nv">a</span>
<span class="k">end</span><span class="w"> </span><span class="nv">defer</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">a</span>
<span class="k">end</span>
</code></pre></div>

<p>(Try it on the playground: <a href="https://play.golang.org/p/agxBcqgCb8">https://play.golang.org/p/agxBcqgCb8</a>)</p>
<p>This time the value passed into panic was returned by the call to <code>recover</code> in
<code>b</code>. In <code>a</code> which contains the same code as <code>b</code> to recover the panic nothing is
returned by <code>recover</code>.</p>
<h4>Implementation</h4>
<p>To implement exceptions, <code>panic</code> is used to throw the <code>Throwable</code> objects. Then
a special function <code>exec</code> is created to execute the <code>try</code> functions:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">Block</span><span class="p">)</span><span class="w"> </span><span class="nx">exec</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="nx">Throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">recover</span><span class="p">();</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">switch</span><span class="w"> </span><span class="nx">exc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">e</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="nx">Throwable</span><span class="p">:</span>
<span class="w">                </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exc</span>
<span class="w">            </span><span class="k">default</span><span class="p">:</span>
<span class="w">                </span><span class="nb">panic</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}()</span>
<span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">try</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</code></pre></div>

<p>This function simply calls the function passed into <code>Try()</code>. However, <code>exec</code> also
registers a <code>defer</code> which changes the returned value of <code>exec</code> if a <code>Throwable</code>
is discovered. Thus, we can throw exceptions with <code>panic</code> (no changes
necessary!) and catch them with <code>recover</code>. The final piece is implementing the
semantics of try, catch, finally. This is accomplished by a function called
<code>run</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">Block</span><span class="p">)</span><span class="w"> </span><span class="nx">run</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nx">Throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">exec</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">catches</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">isa</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Try</span><span class="p">(</span><span class="kd">func</span><span class="p">(){</span><span class="nx">c</span><span class="p">.</span><span class="nx">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)}).</span><span class="nx">exec</span><span class="p">()</span>
<span class="w">                </span><span class="k">break</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">finally</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">finallies</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">finally</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>
</code></pre></div>

<p>The <code>run</code> function first executes the <code>try</code> and gets the error if any. If there
is an error it tries to find a catch function to handle it (using the <code>isa</code>
helper function to identify the catcher). Then whether or not a catch function
was found, all <code>finally</code> functions are run in order of declaration. The final
trick is the <code>catch</code> functions are run inside of a <code>Try</code> block and <code>exec</code>
directly in case they re-throw exceptions. That is it! Check out the <a href="https://github.com/timtadh/data-structures/tree/master/exc">source
code</a> for more
details.</p>
<h2>Conclusion</h2>
<p>There are good reasons why Go does not include exceptions at the language level.
However, at times their absence can become annoying. So I created this little
library that adds them to Go. You probably shouldn't make public APIs based on
it, but it may help you write certain internal code more clearly. One clear use
case is during a refactor adding <code>Throw</code> call in a deep internal function which
should have always returned an error. Then at the entry points to the API simply
wrap up in a <code>Try().Catch().Error()</code> which would accomplish the same thing as
adding a returned error throughout the library.</p>
<p>I hope you enjoy this little experiment of mine and don't send me too much hate
mail! I know that exceptions are controversal in the Go community. This library
tries to demonstrate how close <code>panic</code> and <code>recover</code> are to exceptions and how
to emulate exceptions using <code>panic</code> and <code>recover</code>.</p>
<p><a href="https://github.com/timtadh/data-structures/tree/master/exc">Check it out!</a>.</p>
      </div>
      </article> <!-- /#page-main -->

      </div>  <!-- /#page-body -->

      <footer id="page-foot">
        <div class="bottom-nav">
<ul>
    <li><a href="https://hackthology.com/articles.html">articles</a></li>
    <li><a href="https://hackthology.com/pages/about.html">about</a></li>
    <li><a href="https://hackthology.com/pages/publications.html">publications</a></li>
    <li><a href="https://hackthology.com/pages/teaching.html">teaching</a></li>
</ul>
<ul>
    <li><a href="https://hackthology.com/feeds/rss.xml">rss-feed</a></li>
    <li><a href="https://github.com/timtadh">github</a></li>
    <li><a href="https://twitter.com/timtadh">twitter</a></li>
    <li><a href="https://www.linkedin.com/in/tadh">linkedin</a></li>
    <li><a href="https://keybase.io/tadh">keybase</a></li>
</ul></div>
        <p>Copyright 2016 Tim Henderson. All Rights Reserved.</p>
      </footer>
    </div> <!-- /#page -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-20145944-2']);
          _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); 
        ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>